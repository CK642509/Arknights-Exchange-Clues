# Arknights-Exchange-Clues
## 簡介
這是一個給明日方舟玩家使用的工具，用於計算玩家之間交換相同線索的最佳解

## 動機
原先是 Yao 開發出第一版 (用 C++ 寫的，再編譯成執行檔)，但後續為了讓大家使用起來更方便，我嘗試整合到 [Discord BOT](https://github.com/CK642509/DiscordBOT-Arknights) 上 (使用 Python 開發)。過程中遇到了諸多問題，儘管最終算是有成功整合，但該作法會導致在部屬 Discord BOT 時，只適合部屬在 Windows 電腦中，很難打包成 Docker image。

因此，希望使用 Python 重構整個工具。

## 作用原理
1. 取得基本資訊
   - 玩家名單
   - 各玩家持有的線索
   - 各玩家想交換的線索
2. 準備錯列 (derangement) 的所有情況
   > 例如：三方交換的錯列有兩種情況：[2, 3, 1]、[3, 1, 2]
3. 建立玩家持有線索矩陣 (`all_store`) 與 玩家需求矩陣 (`all_want`)
4. 檢查玩家需求矩陣
   - 是否自己沒有線索卻想要跟其他玩家交換
   - 如果持有三張以上的某個線索，則強制把該線索加入需求矩陣
   - 如果全部只有一位玩家擁有某個線索，則強制把該線索移出需求矩陣
5. 評估可能的交換情況 (condition)
   > - 若玩家擁有某個線索，卻沒有將其列入需求，則該玩家是否交換該線索就是一個變因
   > - 交換情況數量 = 2 ^ (變因數量)
6. 評估是否可以負荷該數量的交換情況的計算量，可以的話就進入下一步；反之，則重新檢查需求矩陣 (步驟 4)，並增加限制，以降低變因數量
   > 由於交換情況隨著變因數增加而指數增加，計算時間也會急速增加
7. 取得第一個交換情況，找出該情況下的最佳錯列作法 (`best_solution`)
   1. 從參與交換的玩家數最少的線索開始計算
      > 依序檢查是否有兩方交換的線索、是否有三方交換的線索...以此類推
   2. 評估一個錯列作法是不是一個「好」的錯列作法的判斷標準目前只有一個：
      - 玩家兩兩之間的交換組合最少
        > 例如：若線索 1 為玩家 A 與玩家 B 兩方交換，則當線索 2 為玩家 A、B、C、D 四方交換時，[B, A, D, C] 就優於 [B, C, D, A]
8. 用窮舉的方式，評估所有交換情況是不是一個「好」的交換情況，判斷標準如下 (依照優先程度高到低)：
   1. 交換 0 張線索的玩家最少
   2. 交換 1 張線索的玩家最少
   3. 交換 6 張線索的玩家最少
   4. 玩家兩兩之間的交換組合最少
   5. 總交換次數最少
9.  找出最好的交換情況，並輸出結果
